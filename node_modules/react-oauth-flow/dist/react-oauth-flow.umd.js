!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("qs"),require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["exports","qs","react","prop-types"],t):t(e.reactOauthFlow={},e.qs,e.react,e.PropTypes)}(this,function(e,t,r,n){t=t&&t.hasOwnProperty("default")?t.default:t,n=n&&n.hasOwnProperty("default")?n.default:n;var o=function(e,t,r){return Object.defineProperty(e,t,{enumerable:!1,configurable:!1,writable:!1,value:r}),e};function i(e,r){if(null==r)return e;var n=t.stringify(r);return n?e+(e.indexOf("?")<0?"?":"&")+n:e}var s=function(e){function n(t){e.call(this,t),this.state={processing:!0,state:null,error:null},this.getAuthorizationCode=this.getAuthorizationCode.bind(this),this.handleError=this.handleError.bind(this),this.parseQuerystring=this.parseQuerystring.bind(this)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.componentDidMount=function(){this.getAuthorizationCode()},n.prototype.getAuthorizationCode=function(){var e=this;try{var t=this.props,r=t.tokenUrl,n=t.tokenFetchArgs,s=t.clientId,c=t.clientSecret,u=t.redirectUri,l=t.args,a=t.tokenFn,p=t.onAuthSuccess,d=this.parseQuerystring(),h=d.error,f=d.error_description,g=d.code,y=JSON.parse(d.state||null);if(y&&this.setState(function(){return{state:y}}),null!=h)throw new Error(f);var b=i(""+r,Object.assign({},{code:g,grant_type:"authorization_code",client_id:s,client_secret:c,redirect_uri:u},l)),O=new Headers({"Content-Type":"application/json"}),m=Object.assign({method:"POST",headers:O},n);("function"==typeof a?a(b,m):function(e,t){var r=fetch(e,t);return r.then(function(e){if(!e.ok)throw e;return e.json()}).catch(function(e){return e.json().then(function(t){var n=new Error(e.statusText);throw o(n,"response",e),o(n.response,"data",t),o(n,"request",r),n})})}(b,m)).then(function(t){"function"==typeof p&&p(t.access_token,{response:t,state:y}),e.setState(function(){return{processing:!1}})}).catch(function(t){e.handleError(t),e.setState(function(){return{processing:!1}})})}catch(e){this.handleError(e),this.setState(function(){return{processing:!1}})}},n.prototype.handleError=function(e){var t=this.props.onAuthError;this.setState(function(){return{error:e}}),"function"==typeof t&&t(e)},n.prototype.parseQuerystring=function(){var e,r=this.props,n=r.location,o=r.querystring;return e=null!=n?n.search:null!=o?o:window.location.search,t.parse(e,{ignoreQueryPrefix:!0})},n.prototype.render=function(){var e=this.props,t=e.component,n=e.render,o=e.children,i=this.state,s=i.processing,c=i.state,u=i.error;return null!=t?r.createElement(t,{processing:s,state:c,error:u}):null!=n?n({processing:s,state:c,error:u}):null!=o?(r.Children.only(o),o({processing:s,state:c,error:u})):null},n}(r.Component);s.propTypes={tokenUrl:n.string.isRequired,clientId:n.string.isRequired,clientSecret:n.string.isRequired,redirectUri:n.string.isRequired,args:n.objectOf(n.oneOfType([n.string,n.number,n.bool,n.object])),location:n.shape({search:n.string.isRequired}),querystring:n.string,tokenFn:n.func,onAuthSuccess:n.func,onAuthError:n.func,render:n.func,tokenFetchArgs:n.shape({method:n.string}),component:n.element,children:n.func},s.defaultProps={args:{},location:null,querystring:null,tokenFn:null,onAuthSuccess:null,onAuthError:null,render:null,tokenFetchArgs:{},component:null,children:null};var c=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.render=function(){var e=this.props,t=e.state,n=e.args,o=e.render,s=e.component,c=e.children,u=i(""+e.authorizeUrl,Object.assign({},{client_id:e.clientId,redirect_uri:e.redirectUri,response_type:"code",state:t?JSON.stringify(t):void 0},n||{}));return null!=s?r.createElement(s,{url:u}):null!=o?o({url:u}):null!=c?(r.Children.only(c),c({url:u})):null},t}(r.Component);c.propTypes={authorizeUrl:n.string.isRequired,clientId:n.string.isRequired,redirectUri:n.string.isRequired,state:n.objectOf(n.oneOfType([n.string,n.number,n.bool,n.object])),args:n.objectOf(n.oneOfType([n.string,n.number,n.bool,n.object])),render:n.func,component:n.element,children:n.func},c.defaultProps={state:null,args:null,render:null,component:null,children:null},e.createOauthFlow=function(e){void 0===e&&(e={});var t=e.authorizeUrl,r=e.tokenUrl,n=e.clientId,o=e.clientSecret,i=e.redirectUri,u=e.appName;return{Sender:function(e){return h(c,Object.assign({},{authorizeUrl:t,clientId:n,redirectUri:i},e))},Receiver:function(e){return h(s,Object.assign({},{tokenUrl:r,clientId:n,clientSecret:o,redirectUri:i,appName:u},e))}}},e.OauthSender=c,e.OauthReceiver=s});
//# sourceMappingURL=react-oauth-flow.umd.js.map
