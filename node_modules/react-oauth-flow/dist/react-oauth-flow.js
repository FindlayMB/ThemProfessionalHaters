function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var r=e(require("qs")),t=require("react"),n=e(require("prop-types")),o=function(e,r,t){return Object.defineProperty(e,r,{enumerable:!1,configurable:!1,writable:!1,value:t}),e};function i(e,t){if(null==t)return e;var n=r.stringify(t);return n?e+(e.indexOf("?")<0?"?":"&")+n:e}var s=function(e){function n(r){e.call(this,r),this.state={processing:!0,state:null,error:null},this.getAuthorizationCode=this.getAuthorizationCode.bind(this),this.handleError=this.handleError.bind(this),this.parseQuerystring=this.parseQuerystring.bind(this)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.componentDidMount=function(){this.getAuthorizationCode()},n.prototype.getAuthorizationCode=function(){var e=this;try{var r=this.props,t=r.tokenUrl,n=r.tokenFetchArgs,s=r.clientId,c=r.clientSecret,u=r.redirectUri,l=r.args,a=r.tokenFn,p=r.onAuthSuccess,h=this.parseQuerystring(),d=h.error,f=h.error_description,g=h.code,y=JSON.parse(h.state||null);if(y&&this.setState(function(){return{state:y}}),null!=d)throw new Error(f);var b=i(""+t,Object.assign({},{code:g,grant_type:"authorization_code",client_id:s,client_secret:c,redirect_uri:u},l)),m=new Headers({"Content-Type":"application/json"}),O=Object.assign({method:"POST",headers:m},n);("function"==typeof a?a(b,O):function(e,r){var t=fetch(e,r);return t.then(function(e){if(!e.ok)throw e;return e.json()}).catch(function(e){return e.json().then(function(r){var n=new Error(e.statusText);throw o(n,"response",e),o(n.response,"data",r),o(n,"request",t),n})})}(b,O)).then(function(r){"function"==typeof p&&p(r.access_token,{response:r,state:y}),e.setState(function(){return{processing:!1}})}).catch(function(r){e.handleError(r),e.setState(function(){return{processing:!1}})})}catch(e){this.handleError(e),this.setState(function(){return{processing:!1}})}},n.prototype.handleError=function(e){var r=this.props.onAuthError;this.setState(function(){return{error:e}}),"function"==typeof r&&r(e)},n.prototype.parseQuerystring=function(){var e,t=this.props,n=t.location,o=t.querystring;return e=null!=n?n.search:null!=o?o:window.location.search,r.parse(e,{ignoreQueryPrefix:!0})},n.prototype.render=function(){var e=this.props,r=e.component,n=e.render,o=e.children,i=this.state,s=i.processing,c=i.state,u=i.error;return null!=r?t.createElement(r,{processing:s,state:c,error:u}):null!=n?n({processing:s,state:c,error:u}):null!=o?(t.Children.only(o),o({processing:s,state:c,error:u})):null},n}(t.Component);s.propTypes={tokenUrl:n.string.isRequired,clientId:n.string.isRequired,clientSecret:n.string.isRequired,redirectUri:n.string.isRequired,args:n.objectOf(n.oneOfType([n.string,n.number,n.bool,n.object])),location:n.shape({search:n.string.isRequired}),querystring:n.string,tokenFn:n.func,onAuthSuccess:n.func,onAuthError:n.func,render:n.func,tokenFetchArgs:n.shape({method:n.string}),component:n.element,children:n.func},s.defaultProps={args:{},location:null,querystring:null,tokenFn:null,onAuthSuccess:null,onAuthError:null,render:null,tokenFetchArgs:{},component:null,children:null};var c=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.render=function(){var e=this.props,r=e.state,n=e.args,o=e.render,s=e.component,c=e.children,u=i(""+e.authorizeUrl,Object.assign({},{client_id:e.clientId,redirect_uri:e.redirectUri,response_type:"code",state:r?JSON.stringify(r):void 0},n||{}));return null!=s?t.createElement(s,{url:u}):null!=o?o({url:u}):null!=c?(t.Children.only(c),c({url:u})):null},r}(t.Component);c.propTypes={authorizeUrl:n.string.isRequired,clientId:n.string.isRequired,redirectUri:n.string.isRequired,state:n.objectOf(n.oneOfType([n.string,n.number,n.bool,n.object])),args:n.objectOf(n.oneOfType([n.string,n.number,n.bool,n.object])),render:n.func,component:n.element,children:n.func},c.defaultProps={state:null,args:null,render:null,component:null,children:null},exports.createOauthFlow=function(e){void 0===e&&(e={});var r=e.authorizeUrl,t=e.tokenUrl,n=e.clientId,o=e.clientSecret,i=e.redirectUri,u=e.appName;return{Sender:function(e){return h(c,Object.assign({},{authorizeUrl:r,clientId:n,redirectUri:i},e))},Receiver:function(e){return h(s,Object.assign({},{tokenUrl:t,clientId:n,clientSecret:o,redirectUri:i,appName:u},e))}}},exports.OauthSender=c,exports.OauthReceiver=s;
//# sourceMappingURL=react-oauth-flow.js.map
